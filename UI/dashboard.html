<!doctype html>
<html>
<head>

<title>iReporter</title>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<link rel="stylesheet" href="css/app.css">
<script src="js/app.js"></script>
</head>
<body onload="checkAuth(); updateNavBar();">
    <div>
        <nav class="p-1">
            <div class="container">
                <div class="header-top black">
                    <h1 class=""><a href="index.html">iReporter</a></h1>
        
                    <div id="nav_controls" class="flex header-nav item-center">
                        <a class="black text-normal" href="dashboard.html">Dashboard</a>
                        <a class="black text-normal" href="profile.html">Profile</a>
                        <a id="signup" class="black text-normal border signup-button box-shadow" href="login.html">Sign In</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex">
            <div class="w-quarter content-wrap">
                <div class="flex flex-column content-left px-3-md pt-6 tab">
                    <span class="flex flex-wrap pt-2 pointer">
                        <a class="font-monseratt grey-light bold tablinks" onclick="fetchCategory('red_flag')" >
                            <i class="far fa-flag"></i> &nbsp; Red Flags
                        </a>
                    </span>
                    <span class="flex flex-wrap pt-2 tablinks pointer">
                        <a class="font-monseratt grey-light bold" onclick="fetchCategory('intervention')" >
                            <i class="fas fa-hands-helping"></i> &nbsp; Interventions
                        </a>
                    </span>
                    <span class="flex flex-wrap pt-2 tablinks pointer" onclick="fetchUsers()">
                        <a class="font-monseratt grey-light bold">
                            <i class="fas fa-user"></i> &nbsp; Users
                        </a>
                    </span>
                </div>
            </div>

            <div id="dash_container" class="w-rem bg-grey-lighter flex flex-column">
                
                <div class="flex justify-end mr-4 mt-2">
                    <a class="black font-monseratt border signup-button box-shadow bg-blue-lighter" href="new_record.html">
                        New Incident
                    </a>
                </div>
                
                <table id="cool_table">
                    <thead>
                        <tr class="font-monseratt fs-sm grey-light">
                            <th></th>
                            <th>Title</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Created At</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>                
            </div>
        </div>
    </div>
    <script>
        incidentUrl = baseUrl + 'incidents'  
        token = localStorage.getItem('auth_token')
        
        if (token) {
            document.getElementById('signup').style = 'display: none;'
        }
       
        get(incidentUrl)
        .then(response => response.json())
        .then(data => {
            columns = ['id', 'title', 'incident_type', 'location', 'status', 'created_at']
            renderTableContent('cool_table', columns, data.data)
        }).catch(error => {
            console.log(error)
        })

        function fetchCategory(category) {
            get(baseUrl + 'incidents/' + category)
            .then(response => response.json())
            .then(data => {
                columns = ['id', 'title', 'incident_type', 'location', 'status', 'created_at']
                
                table = document.getElementById('cool_table')
                table.tBodies[0].parentNode.replaceChild(document.createElement('tbody'), table.tBodies[0])
                renderTableContent('cool_table', columns, data.data)
            })
        }

        function fetchUsers() {
            get(baseUrl + 'users')
            .then(response => response.json())
            .then(data => {
                console.log(data)
                columns = ['id', 'firstname', 'lastname', 'email', 'registered', 'roles']
                
                table = document.getElementById('cool_table')
                thead = [].forEach.call(table.tHead.rows[0].cells, cell => {
                    if (cell.cellIndex === 0 || cell.cellIndex === columns.length ) { return }
                    
                    cell.innerText = columns[cell.cellIndex]
                })

                table.tBodies[0].parentNode.replaceChild(document.createElement('tbody'), table.tBodies[0])
                renderTableContent('cool_table', columns, data.data)
            })
        }


</script>
</body>
</html>
