<!doctype html>
<html>
  <head>
    
    <title>iReporter</title>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300" rel="stylesheet">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script src="js/app.js"></script>
</head>
  <body onload="checkAuth(); updateNavBar()">
      <div>
        <nav class="p-1">
            <div class="container">
                <div class="header-top black">
                    <h1 class=""><a href="index.html">iReporter</a></h1>
        
                    <div id="nav_controls" class="flex header-nav item-center">
                        <a class="black text-normal" href="dashboard.html">Dashboard</a>
                        <a class="black text-normal" href="profile.html">Profile</a>
                        <a id="signup" class="black text-normal border signup-button box-shadow" href="signup.html">Sign Up</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="px-12 mb-6 mt-2">
            <div class="flex-container flex-column box-shadow-bg">
                <div class="flex flex-start item-center m-4 border-bottom">
                    <div>
                        <img class="border-rounded-full m-1" src="https://via.placeholder.com/300/09f/fff.png" alt="">
                    </div>
        
                    <div class="h-full">
                        <div class="px-1">
                            <label for="name">Name: &nbsp;</label>
                            <span id="name" class="font-monseratt">Vincent Jasuba</span>
                        </div>
        
                        <div class="px-1">
                            <div>
                                <label for="email">Email: &nbsp;</label>
                                <span id="email" class="font-monseratt">ovincent7949@gmail.com</span>
                            </div>
                        </div>
                        
                        <div class="px-1">
                            <div>
                                <label for="role">Role: &nbsp;</label>
                                <span id="user_role" class="font-monseratt">User</span>
                            </div>
                        </div>
                    </div>
                    <div class="px-1 flex flex-column border-left">
                        <div class="flex flex-column mt-2">

                            <a href="#" ><i class="far fa-flag"></i> &nbsp; Red Flags</a>

                            <div class="flex flex-column">
                                <span class="font-monseratt">Resolved: <strong id="resolved_rf">1</strong></span>
                                <span class="font-monseratt">Pending: <strong id="pending_rf">1</strong></span>
                                <span class="font-monseratt mt-1">Accepted: <strong id="accepted_rf">10</strong></span>
                                <span class="font-monseratt">Rejected: <strong id="rejected_rf">2</strong></span>
                                <span class="font-monseratt">Under Investigation: <strong id="under_investigation_rf">2</strong></span>
                            </div>

                        </div>
                        <div class="flex flex-column mt-2">

                            <a href="#"><i class="fas fa-hands-helping"></i> &nbsp; Interventions</a>

                            <div class="flex flex-column">
                                <span class="font-monseratt">Resolved: <strong id="resolved_ir">1</strong></span>
                                <span class="font-monseratt">Pending: <strong id="pending_ir">0</strong></span>
                                <span class="font-monseratt mt-1">Accepted: <strong id="accepted_ir">2</strong></span>
                                <span class="font-monseratt">Rejected: <strong id="rejected_ir">7</strong></span>
                                <span class="font-monseratt">Under Investigation: <strong id="under_investigation_ir">2</strong></span>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="flex flex-column mt-2 mb-2">

                    <div class="flex justify-end mr-4 mt-2">
                        <a class="black font-monseratt border signup-button box-shadow bg-blue-lighter" href="new_record.html">New Incident</a>
                    </div>
                    
                    <table id="user_records">
                        <thead>
                            <tr class="font-monseratt fs-sm grey-light">
                                <th></th>
                                <th>Title</th>
                                <th>Type</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by js -->
                        </tbody>
                    </table>        
                </div>
            </div>
        </div>
      </div>
      <script>
        if (localStorage.getItem('auth_token')) {
            document.getElementById('signup').style = 'display: none;'
        }

        get(baseUrl + 'users/incidents')
        .then(response => response.json())
        .then(data => {
            columns = ['id', 'title', 'incident_type', 'location', 'status', 'created_at']
            renderTableContent('user_records', columns, data.data)
            loadUserProfile()
            statistics(data.data)
        }).catch(error => {
            console.log(error)
        })

        currentUser = JSON.parse(localStorage.auth_user)
        document.getElementById('email').innerHTML = currentUser.email
        document.getElementById('name').innerHTML = currentUser.firstname + ' ' + currentUser.lastname
        document.getElementById('user_role').innerHTML = currentUser.isAdmin ? 'Admin': 'User'
      </script>
  </body>
</html>